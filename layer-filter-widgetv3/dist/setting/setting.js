System.register(["jimu-core","jimu-ui/advanced/setting-components","jimu-ui/advanced/data-source-selector","jimu-ui"],(function(e,t){var i={},o={},l={},a={};return{setters:[function(e){i.AllDataSourceTypes=e.AllDataSourceTypes,i.DataSourceManager=e.DataSourceManager,i.Immutable=e.Immutable,i.React=e.React,i.jsx=e.jsx},function(e){o.MapWidgetSelector=e.MapWidgetSelector,o.SettingRow=e.SettingRow,o.SettingSection=e.SettingSection},function(e){l.DataSourceSelector=e.DataSourceSelector},function(e){a.Checkbox=e.Checkbox}],execute:function(){e((()=>{var e={244:e=>{"use strict";e.exports=i},321:e=>{"use strict";e.exports=a},89:e=>{"use strict";e.exports=l},298:e=>{"use strict";e.exports=o}},t={};function s(i){var o=t[i];if(void 0!==o)return o.exports;var l=t[i]={exports:{}};return e[i](l,l.exports,s),l.exports}s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.p="";var n={};return s.p=window.jimuConfig.baseUrl,(()=>{"use strict";s.r(n),s.d(n,{__set_webpack_public_path__:()=>d,default:()=>a});var e=s(244),t=s(298),i=s(89),o=s(321),l=function(e,t,i,o){return new(i||(i=Promise))((function(l,a){function s(e){try{d(o.next(e))}catch(e){a(e)}}function n(e){try{d(o.throw(e))}catch(e){a(e)}}function d(e){var t;e.done?l(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,n)}d((o=o.apply(e,t||[])).next())}))};class a extends e.React.PureComponent{constructor(t){super(t),this.loadAvailableFields=()=>l(this,void 0,void 0,(function*(){const{config:t}=this.props;if(null==t?void 0:t.layerId){this.setState({loadingFields:!0});try{const i=e.DataSourceManager.getInstance().getDataSource(t.layerId);if(!i||!i.layer)return console.warn("DataSource not available or layer missing."),void this.setState({loadingFields:!1});const o=(i.layer.fields||[]).filter((e=>["string","small-integer","integer","double"].includes(e.type))).map((e=>({name:e.name,alias:e.alias||e.name,type:e.type})));this.setState({availableFields:o,loadingFields:!1})}catch(e){console.error("Error loading fields:",e),this.setState({loadingFields:!1})}}})),this.onToggleUseDataEnabled=e=>{this.props.onSettingChange({id:this.props.id,useDataSourcesEnabled:e})},this.onDataSourceChange=e=>{var t;if(!e||0===e.length)return;const i=(null===(t=e[0])||void 0===t?void 0:t.dataSourceId)||"";this.props.onSettingChange({id:this.props.id,config:this.props.config.set("layerId",i).set("allowedFields",[]),useDataSources:e}),this.setState({selectedDataSourceId:i},(()=>{this.loadAvailableFields()}))},this.onMapWidgetSelected=e=>{this.props.onSettingChange({id:this.props.id,useMapWidgetIds:e})},this.onFieldToggle=(e,t)=>{const{config:i}=this.props;let o=(null==i?void 0:i.allowedFields)||[];t?o.includes(e)||(o=[...o,e]):o=o.filter((t=>t!==e)),this.props.onSettingChange({id:this.props.id,config:i.set("allowedFields",o)})};const i=t.config||(0,e.Immutable)({layerId:"",allowedFields:[]});this.state={selectedDataSourceId:i.layerId||"",availableFields:[],loadingFields:!1}}componentDidMount(){var e;(null===(e=this.props.config)||void 0===e?void 0:e.layerId)&&this.loadAvailableFields()}componentDidUpdate(e){var t,i,o;(null===(t=this.props.config)||void 0===t?void 0:t.layerId)!==(null===(i=e.config)||void 0===i?void 0:i.layerId)&&(null===(o=this.props.config)||void 0===o?void 0:o.layerId)&&this.loadAvailableFields()}render(){const{config:l,useDataSources:a}=this.props,{availableFields:s,loadingFields:n}=this.state,d=(null==l?void 0:l.allowedFields)||[];return l?(0,e.jsx)("div",{css:{width:"100%",height:"100%",padding:"16px"}},(0,e.jsx)(t.SettingSection,{title:"Map Configuration"},(0,e.jsx)(t.SettingRow,null,(0,e.jsx)("div",{style:{width:"100%"}},(0,e.jsx)("label",{style:{fontWeight:"bold",marginBottom:"8px",display:"block"}},"Select Map Widget:"),(0,e.jsx)(t.MapWidgetSelector,{onSelect:this.onMapWidgetSelected,useMapWidgetIds:this.props.useMapWidgetIds})))),(0,e.jsx)(t.SettingSection,{title:"Data Source Configuration"},(0,e.jsx)(t.SettingRow,null,(0,e.jsx)("div",{style:{width:"100%"}},(0,e.jsx)("label",{style:{fontWeight:"bold",marginBottom:"8px",display:"block"}},"Select Layer to Filter:"),(0,e.jsx)(i.DataSourceSelector,{types:(0,e.Immutable)([e.AllDataSourceTypes.FeatureLayer]),useDataSources:a,mustUseDataSource:!0,onChange:this.onDataSourceChange,widgetId:this.props.id}))),(null==l?void 0:l.layerId)&&(0,e.jsx)(t.SettingRow,null,(0,e.jsx)("div",{style:{padding:"12px",backgroundColor:"#f0f8ff",borderRadius:"4px",border:"1px solid #d1ecf1"}},(0,e.jsx)("p",{style:{margin:0,fontSize:"14px",color:"#0c5460"}},(0,e.jsx)("strong",null,"Selected Layer ID:")," ",l.layerId)))),(null==l?void 0:l.layerId)&&(0,e.jsx)(t.SettingSection,{title:"Field Configuration"},(0,e.jsx)(t.SettingRow,null,(0,e.jsx)("div",{style:{width:"100%"}},(0,e.jsx)("label",{style:{fontWeight:"bold",marginBottom:"12px",display:"block"}},"Select Fields Available to Users:"),n?(0,e.jsx)("div",{style:{padding:"16px",textAlign:"center",color:"#666"}},"Loading available fields..."):s.length>0?(0,e.jsx)("div",{style:{maxHeight:"300px",overflowY:"auto",border:"1px solid #dee2e6",borderRadius:"4px",padding:"8px"}},s.map((t=>(0,e.jsx)("div",{key:t.name,style:{display:"flex",alignItems:"center",padding:"8px",borderBottom:"1px solid #f0f0f0"}},(0,e.jsx)(o.Checkbox,{checked:d.includes(t.name),onChange:e=>this.onFieldToggle(t.name,e.target.checked),style:{marginRight:"12px"}}),(0,e.jsx)("div",{style:{flex:1}},(0,e.jsx)("div",{style:{fontWeight:"bold",fontSize:"14px"}},t.alias),(0,e.jsx)("div",{style:{fontSize:"12px",color:"#999"}},t.name," (",t.type,")")))))):(0,e.jsx)("div",{style:{padding:"16px",textAlign:"center",color:"#999"}},"No compatible fields found in the selected layer."),d.length>0&&(0,e.jsx)("div",{style:{marginTop:"12px",padding:"12px",backgroundColor:"#f8f9fa",borderRadius:"4px"}},(0,e.jsx)("strong",null,"Selected Fields (",d.length,"):"),(0,e.jsx)("div",{style:{marginTop:"4px",fontSize:"12px"}},d.join(", "))))))):(0,e.jsx)("div",{style:{padding:"1rem",color:"#999"}},"Configuration not loaded.")}}function d(e){s.p=e}})(),n})())}}}));