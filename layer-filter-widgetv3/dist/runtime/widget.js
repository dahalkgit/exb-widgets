System.register(["jimu-core","jimu-arcgis","jimu-ui","esri/rest/support/Query"],(function(e,t){var i={},l={},n={},a={};return{setters:[function(e){i.React=e.React,i.jsx=e.jsx},function(e){l.JimuMapViewComponent=e.JimuMapViewComponent},function(e){n.Button=e.Button,n.Loading=e.Loading,n.Option=e.Option,n.Select=e.Select,n.TextInput=e.TextInput},function(e){a.default=e.default}],execute:function(){e((()=>{var e={510:e=>{"use strict";e.exports=a},686:e=>{"use strict";e.exports=l},244:e=>{"use strict";e.exports=i},321:e=>{"use strict";e.exports=n}},t={};function s(i){var l=t[i];if(void 0!==l)return l.exports;var n=t[i]={exports:{}};return e[i](n,n.exports,s),n.exports}s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.p="";var o={};return s.p=window.jimuConfig.baseUrl,(()=>{"use strict";s.r(o),s.d(o,{__set_webpack_public_path__:()=>r,default:()=>a});var e=s(244),t=s(686),i=s(321),l=s(510),n=function(e,t,i,l){return new(i||(i=Promise))((function(n,a){function s(e){try{r(l.next(e))}catch(e){a(e)}}function o(e){try{r(l.throw(e))}catch(e){a(e)}}function r(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,o)}r((l=l.apply(e,t||[])).next())}))};class a extends e.React.PureComponent{constructor(e){super(e),this.onActiveViewChange=e=>{e&&this.setState({jimuMapView:e},(()=>this.loadLayer()))},this.loadLayer=()=>n(this,void 0,void 0,(function*(){var e,t,i,l,n;const{config:a}=this.props,{jimuMapView:s}=this.state;if((null==a?void 0:a.layerId)&&s)try{let o="function"==typeof s.whenJimuLayerViewAdded?yield s.whenJimuLayerViewAdded(a.layerId):null;if(o||"function"!=typeof s.getJimuLayerViewByDataSourceId||(o=s.getJimuLayerViewByDataSourceId(a.layerId)),!o){const e=s.jimuLayerViews||{};for(const t in e){const i=e[t];if((null==i?void 0:i.layerDataSourceId)===a.layerId){o=i;break}}}if(o){const e=yield o.createLayerDataSource(),t=null==e?void 0:e.layer;if(t)return void this.setState({layer:t,jimuLayerView:o})}const r=null===(i=null===(t=null===(e=window.jimu)||void 0===e?void 0:e.dsManager)||void 0===t?void 0:t.getDataSource)||void 0===i?void 0:i.call(t,a.layerId),u=null===(n=null===(l=null==r?void 0:r.getDataSourceJson)||void 0===l?void 0:l.call(r))||void 0===n?void 0:n.url;if(u){const e=this.state.jimuMapView.view.map.layers.find((e=>e.url===u));e&&this.setState({layer:e,jimuLayerView:null})}}catch(e){console.error("Error loading layer:",e)}})),this.onFieldChange=e=>n(this,void 0,void 0,(function*(){const t=e.target.value;this.setState({selectedField:t,loading:!0,uniqueValues:[],selectedValue:""});const{layer:i}=this.state;if(t&&i)try{const e=i.createQuery?i.createQuery():new l.default;e.returnDistinctValues=!0,e.outFields=[t],e.where=`${t} IS NOT NULL`,e.returnGeometry=!1,e.orderByFields=[t];const n=(yield i.queryFeatures(e)).features.map((e=>e.attributes[t])).filter((e=>null!=e&&""!==e)).sort(((e,t)=>(e+"").localeCompare(t+"")));this.setState({uniqueValues:n,loading:!1})}catch(e){console.error("Error querying unique values:",e),this.setState({loading:!1})}else this.setState({loading:!1})})),this.onSearchChange=e=>this.setState({searchValue:e.target.value}),this.onValueSelect=e=>this.setState({selectedValue:e.target.value}),this.applyFilter=()=>n(this,void 0,void 0,(function*(){const{selectedField:e,selectedValue:t,layer:i,jimuLayerView:l}=this.state;if(!i||!e||!t)return;const n=`${e} = '${String(t).replace(/'/g,"''")}'`;try{i.definitionExpression=n,(null==l?void 0:l.setDefinitionExpression)&&(yield l.setDefinitionExpression(n));const{extent:e}=yield i.queryExtent({where:n});e&&(yield this.state.jimuMapView.view.goTo(e.expand(1.2)))}catch(e){console.error("Error applying filter:",e)}})),this.clearFilter=()=>n(this,void 0,void 0,(function*(){const{layer:e,jimuLayerView:t}=this.state;if(e)try{e.definitionExpression="",(null==t?void 0:t.setDefinitionExpression)&&(yield t.setDefinitionExpression(""))}catch(e){console.error("Error clearing filter:",e)}finally{this.setState({selectedValue:"",searchValue:""})}})),this.getFilteredValues=()=>{const{uniqueValues:e,searchValue:t}=this.state;if(!t)return e;const i=t.toLowerCase();return e.filter((e=>(e+"").toLowerCase().includes(i)))},this.getFieldOptions=()=>{const{layer:e}=this.state,{config:t}=this.props;if(!e||!e.fields)return[];const i=(null==t?void 0:t.allowedFields)||[],l=e=>"string"===e.type||"small-integer"===e.type||"integer"===e.type||"double"===e.type;return(i.length?e.fields.filter((e=>i.includes(e.name)&&l(e))):e.fields.filter(l)).map((e=>({label:e.alias||e.name,value:e.name})))},this.state={jimuMapView:null,selectedField:"",searchValue:"",uniqueValues:[],selectedValue:"",loading:!1,layer:null,jimuLayerView:null}}componentDidUpdate(e){var t,i;(null===(t=this.props.config)||void 0===t?void 0:t.layerId)!==(null===(i=e.config)||void 0===i?void 0:i.layerId)&&this.state.jimuMapView&&this.loadLayer()}render(){const{useMapWidgetIds:l,config:n}=this.props,{selectedField:a,searchValue:s,selectedValue:o,loading:r}=this.state;if(!(null==n?void 0:n.layerId))return(0,e.jsx)("div",{css:{padding:"20px",textAlign:"center",color:"#666"}},"Please configure the widget by selecting a layer.");const u=this.getFieldOptions(),d=this.getFilteredValues();return(0,e.jsx)("div",{css:{width:"100%",height:"100%",padding:"16px",backgroundColor:"#fff",display:"flex",flexDirection:"column",gap:"12px"}},(0,e.jsx)(t.JimuMapViewComponent,{useMapWidgetId:null==l?void 0:l[0],onActiveViewChange:this.onActiveViewChange}),(0,e.jsx)("div",null,(0,e.jsx)("label",{css:{display:"block",marginBottom:"4px",fontWeight:"bold"}},"Select Field:"),(0,e.jsx)(i.Select,{value:a,onChange:this.onFieldChange,placeholder:"Choose a field...",style:{width:"100%"}},u.map((t=>(0,e.jsx)(i.Option,{key:t.value,value:t.value},t.label))))),a&&(0,e.jsx)("div",null,(0,e.jsx)("label",{css:{display:"block",marginBottom:"4px",fontWeight:"bold"}},"Search Values:"),(0,e.jsx)(i.TextInput,{value:s,onChange:this.onSearchChange,placeholder:"Type to search...",style:{width:"100%"}})),a&&!r&&(0,e.jsx)("div",null,(0,e.jsx)("label",{css:{display:"block",marginBottom:"4px",fontWeight:"bold"}},"Select Value:"),(0,e.jsx)(i.Select,{value:o,onChange:this.onValueSelect,placeholder:"Choose a value...",style:{width:"100%"},maxHeight:200},d.map(((t,l)=>(0,e.jsx)(i.Option,{key:`${t}-${l}`,value:t},t))))),r&&(0,e.jsx)("div",{css:{textAlign:"center",padding:"20px"}},(0,e.jsx)(i.Loading,null)),(0,e.jsx)("div",{css:{display:"flex",gap:"8px",marginTop:"auto"}},(0,e.jsx)(i.Button,{type:"primary",onClick:this.applyFilter,disabled:!a||!o,style:{flex:1}},"Apply Filter"),(0,e.jsx)(i.Button,{onClick:this.clearFilter,disabled:!a,style:{flex:1}},"Clear Filter")))}}function r(e){s.p=e}})(),o})())}}}));